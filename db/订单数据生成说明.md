# 订单数据生成说明

## 一、生成概述

按照《订单数据构建方案分析.md》中的标准方案，已成功生成100个订单的SQL数据。

**生成时间**: 2025-11-19

## 二、数据统计

### 2.1 数据量统计

| 数据类型 | 数量 | 说明 |
|---------|------|------|
| 订单主表 (tz_order) | 100个 | 符合方案要求 |
| 订单项表 (tz_order_item) | 152个 | 平均每个订单1.52个商品 |
| 订单地址快照 (tz_user_addr_order) | 100个 | 每个订单一个地址快照 |
| 订单结算表 (tz_order_settlement) | 83个 | 已支付订单的结算记录 |

### 2.2 订单状态分布

| 订单状态 | 状态值 | 数量 | 占比 | 说明 |
|---------|--------|------|------|------|
| 待付款 | 1 | 12个 | 12% | 符合方案（12%） |
| 待发货 | 2 | 18个 | 18% | 符合方案（18%） |
| 待收货 | 3 | 17个 | 17% | 符合方案（17%） |
| 待评价 | 4 | 13个 | 13% | 符合方案（13%） |
| 交易成功 | 5 | 35个 | 35% | 符合方案（35%） |
| 交易失败 | 6 | 5个 | 5% | 符合方案（5%） |
| **总计** | - | **100个** | **100%** | - |

### 2.3 订单项数量分布

- **单商品订单**: 65个 (65%)
- **2个商品订单**: 25个 (25%)
- **3-5个商品订单**: 9个 (9%)
- **5个以上商品订单**: 1个 (1%)

### 2.4 用户订单分布

- **活跃用户** (5人): 47个订单
- **普通用户** (10人): 48个订单
- **不活跃用户** (5人): 5个订单

## 三、数据特点

### 3.1 时间分布

- **订单创建时间**: 2023年1月 - 2025年11月
- **时间逻辑**: 严格按照订单状态流转逻辑生成时间节点
  - 待付款订单: 最近1-30天内创建，未支付
  - 待发货订单: 最近1-7天内创建，已支付
  - 待收货订单: 最近7-30天内创建，已发货
  - 待评价订单: 最近15-45天内创建，已确认收货
  - 交易成功订单: 30天以前创建，已完成
  - 交易失败订单: 最近1-30天内创建并取消

### 3.2 金额计算

- **订单总金额**: 商品金额总和
- **运费**: 订单金额>100元时免运费，否则随机0/10/15/20元
- **优惠金额**: 大部分订单无优惠，少数订单有5%-10%优惠
- **实际支付金额**: 总金额 + 运费 - 优惠

### 3.3 支付信息

- **支付方式**: 微信支付(1) 或 支付宝(2)
- **支付状态**: 已支付订单(is_payed=1)生成结算记录
- **支付时间**: 订单创建后几分钟内支付

### 3.4 物流信息

- **物流单号**: 已发货订单生成12位数字物流单号
- **发货时间**: 支付后1-3天内发货
- **确认收货时间**: 发货后1-30天内确认收货

## 四、SQL文件说明

### 4.1 文件位置

`/root/cb/mall4j/db/insert_100_orders.sql`

### 4.2 文件结构

1. **字符集设置**: `SET NAMES utf8mb4;`
2. **订单地址快照**: `INSERT INTO tz_user_addr_order ...`
3. **订单主表**: `INSERT INTO tz_order ...`
4. **订单项表**: `INSERT INTO tz_order_item ...`
5. **订单结算表**: `INSERT INTO tz_order_settlement ...`

### 4.3 执行顺序

**重要**: 必须按照以下顺序执行SQL：

1. 先插入订单地址快照（地址快照ID从100开始）
2. 再插入订单主表（引用地址快照ID）
3. 然后插入订单项表（引用订单号）
4. 最后插入订单结算表（引用订单号）

## 五、数据验证

### 5.1 完整性检查

- ✅ 每个订单都有对应的地址快照
- ✅ 每个订单都有对应的订单项
- ✅ 已支付订单都有对应的结算记录
- ✅ 订单号唯一性（使用时间戳+随机数生成）

### 5.2 业务逻辑检查

- ✅ 订单状态与时间字段一致
- ✅ 支付状态与订单状态一致
- ✅ 物流信息与订单状态一致
- ✅ 金额计算正确

## 六、使用方法

### 6.1 执行SQL

```bash
# 进入数据库目录
cd /root/cb/mall4j/db

# 执行SQL文件（使用utf8mb4字符集）
cat insert_100_orders.sql | docker exec -i mall4j-mysql mysql -uroot -proot --default-character-set=utf8mb4 yami_shops
```

### 6.2 验证数据

```sql
-- 检查订单数量
SELECT status, COUNT(*) as count FROM tz_order GROUP BY status;

-- 检查订单项数量
SELECT COUNT(*) FROM tz_order_item;

-- 检查地址快照数量
SELECT COUNT(*) FROM tz_user_addr_order;

-- 检查结算记录数量
SELECT COUNT(*) FROM tz_order_settlement;
```

## 七、注意事项

1. **字符集**: 确保使用utf8mb4字符集执行SQL，避免中文乱码
2. **执行顺序**: 必须按照文件中的顺序执行，否则会出现外键约束错误
3. **地址快照ID**: 从100开始，避免与现有数据冲突
4. **订单号**: 使用时间戳+随机数生成，确保唯一性
5. **时间逻辑**: 订单时间严格按照业务逻辑生成，符合状态流转

## 八、后续扩展

如果需要更多订单数据，可以：

1. 修改 `generate_orders.py` 中的订单数量
2. 调整用户订单分配比例
3. 调整订单状态分布
4. 重新运行脚本生成新的SQL文件

---

**生成脚本**: `/root/cb/mall4j/db/generate_orders.py`
**SQL文件**: `/root/cb/mall4j/db/insert_100_orders.sql`

